C51 COMPILER V9.60.0.0   RF                                                                10/27/2020 09:36:28 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE RF
OBJECT MODULE PLACED IN .\OBJ\RF.obj
COMPILER INVOKED BY: D:\sofeware\Keil\Keil5_MDK\C51\BIN\C51.EXE LIB\RF\RF.c OPTIMIZE(9,SPEED) BROWSE INCDIR(.\USER;.\LIB
                    -\H;.\LIB\eeprom;.\LIB\encoder;.\LIB\Mode;.\LIB\motostep;.\LIB\OSAL;.\LIB\PWM;.\LIB\RF;.\LIB\Scan;.\LIB\Scankey;.\LIB\SEG
                    -;.\LIB\Tick;.\LIB\UART1;.\LIB\Data) DEBUG OBJECTEXTEND PRINT(.\Listings\RF.lst) TABS(2) OBJECT(.\OBJ\RF.obj)

line level    source

   1          #include "main.h" //
   2          
   3          #ifndef uchar
              #define uchar unsigned char
              #endif
   6          #ifndef uint
              #define uint unsigned int
              #endif
   9          #ifndef ulong
              #define ulong unsigned long
              #endif
  12          
  13          
  14          
  15          #define RF_HEAD_MIN 90
  16          #define RF_HEAD_MAX 130
  17          //-
  18          #define RF_0_MIN 1
  19          #define RF_0_MAX 8
  20          //-
  21          #define RF_1_MIN 10
  22          #define RF_1_MAX 20
  23          
  24          //-
  25          #define RF_DATA_LENGHT 24
  26          // bit RF_IO;                          //æ¨¡æ‹ŸIOå£
  27          sbit RF_IO = P3^2;
  28          
  29          bit RF_last_flag;                   //ä¸Šä¸€ä¸ªç”µå¹³çŠ¶æ€æ ‡å¿—ä½
  30          uint RF_tick;                       //ç”µå¹³æ—¶é—´æš‚å­˜å™¨
  31          uint RF_low_time;                   //é«˜ä½ç”µå¹³æ—¶é—´
  32          
  33          uchar xdata RF_analysis_stat=0;   //æ¥æ”¶ç”µå¹³è§£ææµç¨‹æš‚å­˜
  34          ulong xdata RF_data;            //æ¥æ”¶é¥æ§æ•°æ®æš‚å­˜
  35          uchar RF_rnum;                  //å·²æ¥æ”¶ç”µå¹³æ•°é‡
  36          /*ä¾›å¤–éƒ¨ä½¿ç”¨å˜é‡*/
  37          bit RF_K;               //æŒ‰é”®çŠ¶æ€<è™šæ‹Ÿ>
  38          #define RF_K_KEEP 200
  39          uchar RF_delay;         //æŒ‰é”®çŠ¶æ€æŒç»­æ—¶é—´
  40          uchar RF_same_key;      //ç›¸åŒKEY_Næ¬¡æ•°æš‚å­˜          
  41          /*ä¾›å¤–éƒ¨ä½¿ç”¨å˜é‡*/
  42          ulong xdata RF_ID;            //ID
  43          uchar RF_KEY;           //KEY_N
  44          
  45          
  46          #define RF_SAVE_NUM 3
  47          ulong xdata RF_SAVE_ID[RF_SAVE_NUM];
  48          
  49          
  50          /*ä»…è·å–å•ç”µå¹³ä¿¡æ¯*/
  51          uchar Tick_RF(){
  52   1          if(RF_IO){
  53   2              if(!RF_last_flag){
C51 COMPILER V9.60.0.0   RF                                                                10/27/2020 09:36:28 PAGE 2   

  54   3                  RF_low_time = RF_tick;
  55   3                  RF_last_flag = 1;
  56   3            return 1;
  57   3              }
  58   2          }else{
  59   2              if(RF_last_flag){
  60   3                  RF_tick = 0;
  61   3                  RF_last_flag = 0;
  62   3              }
  63   2          }
  64   1          if(RF_tick<65535)RF_tick++;
  65   1          return 0;
  66   1      }
  67          /*
  68          *è§£æRFå­—èŠ‚æ•°æ®
  69          **æ•´ç»„æ•°æ®ä¼ è¾“å®Œæˆåè¿”å› 1
  70          **é¥æ§ç å€¼å­˜å‚¨åœ¨ RF_data ä¸­
  71          */
  72          uchar Analysis_RF(){//RF_analysis_stat=1;
  73   1          switch(RF_analysis_stat){
  74   2              case 0: 
  75   2                  if(RF_low_time>=RF_HEAD_MIN){// && RF_low_time<=RF_HEAD_MAX
  76   3                      RF_analysis_stat=1;
  77   3                      RF_rnum=0;//ccvvbb=1;
  78   3                  }
  79   2              break;
  80   2              case 1: 
  81   2                  if(RF_low_time>=RF_0_MIN && RF_low_time<=RF_0_MAX){
  82   3                      RF_data = (RF_data<<1)+1;
  83   3                      RF_rnum++;
  84   3                  }else if(RF_low_time>=RF_1_MIN && RF_low_time<=RF_1_MAX){
  85   3                      RF_data = (RF_data<<1);
  86   3                      RF_rnum++;
  87   3                  }else{//æ•°æ®å‡ä¸æ­£ç¡®ï¼Œæ¥æ”¶å¤ä½
  88   3                      RF_rnum=0;RF_analysis_stat=0;
  89   3                  }
  90   2                  if(RF_rnum>=RF_DATA_LENGHT){    //æ•°æ®æ¥æ”¶å®Œæˆï¼Œå¤ä½
  91   3                      RF_rnum=0;RF_analysis_stat=0;
  92   3                      return 1;
  93   3                  }
  94   2              break;
  95   2          }
  96   1          return 0;
  97   1      }
  98          /*æ ¡éªŒ KEY å€¼*/
  99          uchar Proof_RF(uchar RK){
 100   1          if(RK==0x01)return 1;
 101   1          if(RK==0x02)return 1;
 102   1          if(RK==0x04)return 1;
 103   1          if(RK==0x08)return 1;
 104   1          return 0;
 105   1      }
 106          /*æ‹†åˆ†ç å€¼*/
 107          void Split_RF(ulong RF_Sdata){
 108   1          RF_ID = (RF_Sdata&0x00fffff0);
 109   1          RF_KEY = (uchar)(RF_Sdata&0x0000000f);
 110   1      }
 111          /*è®¾ç½®é¥æ§æŒ‰é”®æŒ‰ä¸‹*/
 112          void RF_Press(){
 113   1          RF_K = 1;RF_delay = 0;
 114   1      }
 115          /*è®¾ç½®é¥æ§æŒ‰é”®æ¾å¼€*/
C51 COMPILER V9.60.0.0   RF                                                                10/27/2020 09:36:28 PAGE 3   

 116          void RF_Lease(){
 117   1          RF_K = 0;RF_delay = 0;
 118   1      }
 119          
 120          
 121          /**/
 122          uchar RF_cmp_timesRF_cmp_times=0;
 123          bit RF_learn=0;
 124          uchar RF_HLEARN=0;
 125          uchar RF_compart(){
 126   1      
 127   1          if(RF_ID == RF_SAVE_ID[RF_cmp_timesRF_cmp_times])return 1;        //ä¿ç•™ä¸Šä¸€æ¬¡çš„ç»“æœï¼Œé•¿æ—¶é
             -—´æŒ‰ä¸‹æ—¶å‡å°‘èµ„æºæ¶ˆè€—ï¼ˆä¹Ÿè®¸ï¼‰
 128   1      
 129   1          for(RF_cmp_timesRF_cmp_times=0;RF_cmp_timesRF_cmp_times<RF_HLEARN;RF_cmp_timesRF_cmp_times++){
 130   2              if((RF_ID) == RF_SAVE_ID[1])return 1;
 131   2          }
 132   1          return 0;
 133   1      }
 134          /*
 135          **è°ƒç”¨å‡½æ•°
 136          ***ä½¿ç”¨ç¯å¢ƒï¼šå®šæ—¶å™¨ä¸­æ–­ <ä¼˜å…ˆçº§é«˜>
 137          ***å®šæ—¶ x_us
 138          */
 139          void _RF_ISR(){
 140   1          if(++RF_delay>RF_K_KEEP){       //æŒ‰é”®æŒç»­æ—¶é—´ï¼Œä½¿é•¿æŒ‰æ—¶æŒ‰é”®èƒ½å¤Ÿä¿æŒåˆ°ä¸‹ä¸€æ¬¡æŒ‰é”
             -®æ¥æ”¶æˆåŠŸ
 141   2              RF_Lease();
 142   2          }
 143   1          if(Tick_RF()){//--è·å¾—ä¸€æ¬¡ç”µå¹³å˜åŒ–ä¿¡å·çš„ç”µå¹³é•¿åº¦
 144   2              if(Analysis_RF()){//--è‡³æ­¤è·å¾—ä¸€ä¸ªå®Œæ•´çš„ç å€¼
 145   3                  Split_RF(RF_data);      //--æ‹†åˆ†ä¿¡å·ï¼Œè·å¾— ID å’Œ KEY_N
 146   3                  if(Proof_RF(RF_KEY)){RF_same_key++;}else RF_same_key=0;   //æ ¡éªŒ KEY_N,åŒæ—¶æä¾›å˜é‡ RF
             -_same_key ç”¨äºæ ¡éªŒ
 147   3                  if(RF_same_key>=2){RF_same_key=0;       //å¦‚æœåŒä¸€ä¸ªæŒ‰é”®æŒç»­æ£€æµ‹ N æ¬¡ï¼Œå³åˆ¤å®šä
             -¸ºæŒ‰é”®æ­£ç¡®
 148   4                      if(RF_learn){RF_learn=0;
 149   5                          RF_SAVE_ID[RF_HLEARN++] = RF_ID;
 150   5                      }else{
 151   5                          if(RF_compart())RF_Press();
 152   5                      }  
 153   4                  }
 154   3              }
 155   2          }
 156   1      }
 157          
 158          /*
 159          *è·å–é¥æ§æŒ‰é”® <ä¾›å¤–éƒ¨ä½¿ç”¨>
 160          **æŒ‰é”®åˆ¤æ–­æ²¡æœ‰æŒ‰ä¸‹æ—¶ä¹Ÿè¿”å› 0
 161          */
 162          uchar Get_Key(){
 163   1          if(RF_KEY == 0x01)RF_learn=1;
 164   1          if(RF_K){
 165   2              // if(RF_compart){
 166   2                  switch(RF_KEY){
 167   3                      case 0x01: return 1; break;
 168   3                      case 0x02: return 2; break;
 169   3                      case 0x04: return 3; break;
 170   3                      case 0x08: return 4; break;
 171   3                  }
 172   2              // }
 173   2          }
C51 COMPILER V9.60.0.0   RF                                                                10/27/2020 09:36:28 PAGE 4   

 174   1          return 0;
 175   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    529    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     21    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     10       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      3    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
